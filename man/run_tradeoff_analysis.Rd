% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analysis.R
\name{run_tradeoff_analysis}
\alias{run_tradeoff_analysis}
\title{Run a flexible trade-off analysis simulation}
\usage{
run_tradeoff_analysis(data, base_policy, vary_params, parallel = FALSE)
}
\arguments{
\item{data}{A data frame containing the analytical base table.}

\item{base_policy}{A \code{credit_policy} object that serves as the template for
each simulation run.}

\item{vary_params}{A named list of parameters to vary. The function will create
a grid of all combinations of these parameters. For example:
\code{list(new_score_cutoff = seq(500, 600, 10), aggravation_factor = c(1.2, 1.5))}}

\item{parallel}{A logical flag. If \code{TRUE}, the simulation runs in parallel
using \code{furrr}. Defaults to \code{FALSE}.}
}
\value{
A data frame (tibble) summarizing the results for each parameter
combination. It includes columns for each varied parameter, plus
\code{approval_rate} and \code{default_rate}.
}
\description{
This powerful wrapper function automates running multiple simulations to
analyze trade-offs between business and risk metrics. It iterates over a grid
of parameters, dynamically modifying a base credit policy for each combination.
}
\details{
The function generates a parameter grid from the named list provided in
\code{vary_params}. It then iterates through this grid, running a full simulation
for each combination. The function intelligently modifies the policy based on
the names of the parameters in \code{vary_params}:
\itemize{
\item A parameter named \verb{<score_name>_cutoff} will create or modify a
\code{stage_cutoff} for that score.
\item A parameter named \code{aggravation_factor} will create or modify a
\code{stress_aggravation} scenario.
}

This allows for complex sensitivity analyses (e.g., creating an "efficient
frontier" between approval rate and default rate) by varying multiple
business and risk levers simultaneously.

Parallel processing is supported via the \code{furrr} package. If \code{parallel} is
\code{TRUE}, the user must configure their parallel plan beforehand (e.g.,
using \code{future::plan(future::multisession)}).
}
\examples{
# 1. Generate sample data and create a base policy
sample_data <- generate_sample_data(n_applicants = 1000, seed = 42)
sample_data$new_score_decile <- dplyr::ntile(sample_data$new_score, 10)

base_policy <- credit_policy(
  applicant_id_col = "id",
  score_cols = c("old_score", "new_score"),
  current_approval_col = "approved",
  actual_default_col = "defaulted",
  risk_level_col = "new_score_decile",
  simulation_stages = list(
    # A fixed anti-fraud stage for all simulations
    stage_rate(name = "anti_fraud", base_rate = 0.95)
  )
)

# 2. Define parameters to vary
# We will test a few cutoff points and 2 stress scenarios
vary_params <- list(
  new_score_cutoff = seq(500, 700, by = 50),
  aggravation_factor = c(1.2, 1.5)
)

# 3. Run the analysis
tradeoff_results <- run_tradeoff_analysis(
  data = sample_data,
  base_policy = base_policy,
  vary_params = vary_params,
  parallel = FALSE
)

# 4. Plot the results
if (requireNamespace("ggplot2", quietly = TRUE) && requireNamespace("dplyr", quietly = TRUE)) {
  library(ggplot2)
  library(dplyr)
  tradeoff_results \%>\%
    mutate(Stress = paste0(round((aggravation_factor - 1) * 100), "\% PD Aggravation")) \%>\%
    ggplot(aes(x = approval_rate, y = default_rate, color = Stress)) +
    geom_line() +
    geom_point() +
    labs(
      title = "Efficient Frontier: Approval vs. Default Rate",
      x = "Overall Approval Rate", y = "Average Default Rate"
    ) +
    theme_minimal()
}
}
\seealso{
Other analysis: 
\code{\link{summarize_results}()}
}
\concept{analysis}
